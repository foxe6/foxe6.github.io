var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(g){var k=0;return function(){return k<g.length?{done:!1,value:g[k++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.makeIterator=function(g){var k="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];return k?k.call(g):$jscomp.arrayIterator(g)};
$(document).ready(function(){function g(a){$("div#sub_op").addClass("show");$("div#sub_op div.content").html(a);$("div#sub_op").find("input.db_submit").click(m)}function k(){$("div#sub_op").removeClass("show");$("div#sub_op div.content").html("")}function m(a){a.preventDefault();a.stopPropagation();if(confirm("Are you sure?")){var b=$(this);$.post("shop",$(this).closest("form").serialize(),function(c){!0===c?(alert("Updated!"),0==b.closest("div#sub_op").length?window.location.reload(!0):k()):alert(c)})}}
window.addEventListener("pageshow",function(a){(a.persisted||"undefined"!=typeof window.performance&&2===window.performance.navigation.type)&&window.location.reload(!0)});(function(){$("span.preview").mouseenter(function(){$(this).prev().val()&&$("body").prepend('<div id="preview"><img style="max-height: calc(100 * var(--vh)); max-width: 100vw; object-fit: contain;" src="'+$(this).prev().val()+'" /></div>')}).mouseleave(function(){$("div#preview").remove()})})();$("input.db_submit").click(m);$("textarea.to_links").val()&&
$("div.to_links").each(function(){$(this).html(($(this).parent().prev().find("textarea.to_links").val()||"").split(/\r?\n/).map(function(a){return"<a rel='noreferrer' href='"+a+"' target='_blank' style='white-space: nowrap'>"+a.split("?id=").slice(-1)[0]+"</a>"}).join("<br/>"))});$(".db_metadata_blacklist").click(function(){if(confirm("Are you sure?")){var a=$(this).data("meta"),b=$(this).data("key");$.post("shop","db=metadata&op=blacklist&meta="+a+"&key="+b,function(c){if("string"===typeof c)return alert(c);
$(".db_stock_nav_item").eq(1).click()})}});$("input#db_shop_new_row").click(function(){if(confirm("Are you sure?")){try{var a=window.location.search.match(/mfcid=(.*?)($|&)/)[1]}catch(b){a=window.location.search.match(/sku=(.*?)_/)[1]}$.post("shop","db=shop&op=new&mfcid="+a,function(b){if("string"===typeof b)return alert(b);window.location.reload()})}});$("input.db_shop_new_row").click(function(){var a=$(this).data("kind"),b=$(this).data("version"),c=$(this).parent().parent().prev().clone().removeAttr("class");
c.find("input[name='sequence']").attr("value",parseInt($("input[name='sequence']").last().val())+1||0);c.find("input[name='version']").attr("value",b);c.find("input[name='sku']").attr("value","true");c.find("input[name='kind']").attr("value",a);c.find("input[name='price']").attr("value","0");c.find("input[name='final']").attr("value","");c.find("input[name='quantity']").attr("value","9");c.find("span.db_sku_row").click(n);$(this).parent().parent().before(c)});$(".copy_this").click(function(){$(this).select();
document.execCommand("copy");$(this).blur()});$(".copy_this_carousell_content").click(function(){var a=$(this).parent().find("textarea").eq(1),b=a.val(),c=b.split("\n");c[0]+=$(this).val();c=c.join("\n");a.val(c);a.select();document.execCommand("copy");a.blur();a.val(b)});$("input#db_image_new_row").click(function(){var a=window.location.search.match(/mfcid=(.*?)($|&)/)[1];$(this).parent().parent().before('<tr><td><span id="db_delete_row">⮿<input type="hidden" name="remove" value="false" /></span></td><td><input name="rowid" value="true" type="hidden" /><a rel="noreferrer" href="https://myfigurecollection.net/item/'+
a+'" target="_blank">'+a+'</a></td><td><input name="url" value="" size="100" /></td></tr>');$("span#db_delete_row").click(function(){confirm("Are you sure?")&&$(this).parent().parent().remove()})});$("span#db_image_remove_row").click(function(){confirm("Are you sure?")&&$(this).children().attr("value","true").parent().parent().parent().hide()});$("span#db_image_row").click(function(){var a=$(this).closest("tr"),b=a.find("input[name='url']"),c=$(this).closest("table").find("tr");a=c.index(a.get(0));
if(2<=a&&"up"===$(this).data("direction")||a+1<c.length-1&&"down"===$(this).data("direction"))a="up"===$(this).data("direction")?a-1:a+1,c=c.eq(a).find("input[name='url']"),a=c.val(),c.val(b.val()),b.val(a)});$("input.db_order_new_order_new_item").click(function(){if(confirm("Are you sure?")){var a=$(this).parent().parent(),b=a.before().prev().prev().clone();b.find("input").val("");a.before(b);b=a.before().prev().prev().clone();b.find("input").val("");a.before(b)}});$("input.db_proof_disapprove").click(function(){if(confirm("Are you sure?")){var a=
$(this).closest("form");a.find("input[name='op']").val("disapprove");$.post("shop",a.serialize()+"&disapprove="+$(this).val(),function(b){if("string"===typeof b)return alert(b);alert("Updated");window.location.reload(!0)})}});$("input.db_post_op").click(function(){if(confirm("Are you sure?")){var a=$(this).closest("form");a.find("input[name='op']").val($(this).val());$.post("shop",a.serialize(),function(b){if("string"===typeof b)return alert(b);alert("Updated");window.location.reload(!0)})}});$("input#db_shop_delete").click(function(){if(confirm("Are you sure?")){var a=
$(this).closest("form");a.find("input[name='op']").val("remove");$.post("shop",a.serialize(),function(b){if("string"===typeof b)return alert(b);alert("Updated");window.location.href="?db=shop"})}});$("#db_item_blacklist").click(function(){confirm("Are you sure?")&&$.post("shop","db=stock&op=blacklist&mfcid="+$(this).closest("form").find("input[name='mfcid']").val()+"&sku="+window.location.search.match(/sku=([0-9A-Za-z_]+)/)[1],function(a){if("string"===typeof a)return alert(a);$(".db_stock_nav_item").eq(1).click()})});
$("#db_shop_kcots").click(function(){confirm("Are you sure?")&&$.post("shop","db=kcots&op=kcots&sku="+$(this).closest("form").find("input[name='sku']").val(),function(a){if("string"===typeof a)return alert(a);window.location.reload()})});var n=function(){var a=$(this).closest("tr"),b=a.find("input[name='sequence']"),c=$(this).closest("table").find("tr"),f=c.index(a.get(0));if(2<=f&&"up"===$(this).data("direction")||f+1<c.length-1&&"down"===$(this).data("direction"))"up"===$(this).data("direction")?
(a.insertBefore(a.prev()),--f):(a.insertAfter(a.next()),f+=1),a=c.eq(f).find("input[name='sequence']"),c=a.val(),a.val(b.val()),b.val(c)};$("span.db_sku_row").click(n);$("input.db_new_item").click(function(){confirm("Are you sure?")&&$.post("shop",$(this).closest("form").serialize(),function(a){"string"===typeof a?alert(a):window.location.href="?db=item&mfcid="+a}).fail(function(a){alert(JSON.parse(a.responseText).msg)})});$("input.db_add_to_shop").click(function(){window.location.href="?db=shop&mfcid="+
$(this).closest("form").find("input[name='mfcid']").val()});$("input.db_check_sales").click(function(){window.location.href="?db=sales&mfcid="+$(this).closest("form").find("input[name='mfcid']").val()});$("input.db_add_image").click(function(){window.location.href="?db=image&mfcid="+$(this).closest("form").find("input[name='mfcid']").val()});$("input.db_toggle_promotion").click(function(){confirm("Are you sure?")&&$.post("shop","db=promotion&mfcid="+$(this).closest("form").find("input[name='mfcid']").val(),
function(a){"string"==typeof a?alert(a):window.location.reload()})});$("input#db__sql_save").click(function(){confirm("Are you sure?")&&$.post("shop","db=_sql&op=save&_sql="+encodeURIComponent($(this).prev().prev().val()),function(a){"string"==typeof a?alert(a):window.location.reload()})});$("input.db__sql_delete").click(function(){confirm("Are you sure?")&&$.post("shop","db=_sql&op=delete&rowid="+$(this).data("rowid"),function(a){"string"==typeof a?alert(a):window.location.reload()})});$("input.db__sql_load").click(function(){var a=
decodeURIComponent($(this).data("value"));confirm("Are you sure to load:\n\n"+a)&&$(this).parent().parent().find("textarea").val(a)});$("input#db__sql_execute").click(function(){confirm("Are you sure?")&&$.post("shop","db=_sql&op=execute&_sql="+encodeURIComponent($(this).prev().val()),function(a){if("string"==typeof a)alert(a);else if(0===a.length)$("div#_sql_result").html("No result.");else{var b="<table><tr>";for(var c=-1,f=-1,e=$jscomp.makeIterator(Object.keys(a[0])),d=e.next();!d.done;d=e.next())d=
d.value,b+="<th>"+d+"</th>","mfcid"===d?c=Object.keys(a[0]).indexOf(d):"sku"===d&&(f=Object.keys(a[0]).indexOf(d));b+="</tr>";for(e=0;e<a.length;e++){b+="<tr>";var h=$jscomp.makeIterator(Object.keys(a[e]));for(d=h.next();!d.done;d=h.next()){d=d.value;var l=Object.keys(a[e]).indexOf(d);d=a[e][d];null===d&&(d="");l===c?d="<a target='_blank' href='?db=item&mfcid="+d+"'>"+d+"</a>":l===f&&(d="<a target='_blank' href='?db=shop&mfcid="+d.split("_").slice(0)[0]+"'>"+d+"</a>");b+="<td>"+d+"</td>"}b+="</tr>"}b+=
"</table>";$("div#_sql_result").html(b)}}).fail(function(a){alert(JSON.parse(a.responseText).msg)})});$("input#db_item_remove").click(function(){confirm("Are you sure?")&&$.post("shop","db=item&op=remove&mfcid="+$(this).closest("form").find("input[name='mfcid']").val(),function(a){"string"==typeof a?alert(a):(alert("Updated"),window.location.href="?db=item")})});$("input.db_add_to_news").click(function(){$.post("shop","db=news_draft&op="+$(this).data("op")+"&col="+$(this).data("col")+"&mfcid="+$(this).closest("form").find("input[name='mfcid']").val(),
function(a){"string"==typeof a?alert(a):window.location.reload()})});$(".db_news_posted").click(function(){$(this).closest("tr").remove()});$(".db_news_submit").click(function(){if(confirm("Are you sure?")){var a=$(this).closest("form");$.post("shop",a.serialize(),function(b){"string"==typeof b?alert(b):window.location.href+="&rowid="+b})}});$(".db_stock_nav_item").click(function(){var a=$(this).closest("form").find("input[name='db']").val(),b=parseInt($(this).data("offset")),c=window.location.search.match(/sku=([0-9A-Za-z_]+)/)[1],
f=c.match(/([0-9]+)_/)[1];c=$(this).parent().find("select option[value='"+c+"']");0===c.length&&(c=$(this).parent().find("select option[value^='"+f+"']"));if(0===c.length)c=$(this).parent().find("select option[value]:not([disabled]):not([hidden])").eq(0),window.location.href="?db="+a+"&sku="+c.val();else if(-1===b){for(;;){if(0===c.prev().length)return;c=c.prev();if(!c[0].hasAttribute("disabled")&&!c[0].hasAttribute("hidden"))break}c.val()&&(window.location.href="?db="+a+"&sku="+c.val())}else if(1===
b){for(;;){if(0===c.next().length)return;c=c.next();if(!c[0].hasAttribute("disabled")&&!c[0].hasAttribute("hidden"))break}c.val()&&(window.location.href="?db="+a+"&sku="+c.val())}});$("div.table#metadata input[name='value']").each(function(){for(var a=$(this).val(),b=0;b<a.length;b++){var c=JTPYStr().indexOf(a[b]);if(-1!==c)$(this).before(a[b]+":"+FTPYStr()[c]+"&nbsp;"),$(this).closest("form").addClass("selected"),$(this).closest("form").css({"background-color":"orangered"});else if(-1!==JPYStr().indexOf(a[b])){$(this).closest("form").css({"background-color":"red"});
return}}/[\u4E00-\u9FCC\u3400-\u4DB5\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\ud840-\ud868][\udc00-\udfff]|\ud869[\udc00-\uded6\udf00-\udfff]|[\ud86a-\ud86c][\udc00-\udfff]|\ud86d[\udc00-\udf34\udf40-\udfff]|\ud86e[\udc00-\udc1d]/.test($(this).val())||($(this).closest("form").addClass("selected"),$(this).val(" "+$(this).val()))}).mouseup(function(){$(this).val().match(/[\u0080-\uFFFF]/)||this.setSelectionRange(0,0)}).keydown(function(a){13===a.keyCode&&(a.preventDefault(),
a.stopPropagation(),confirm("Are you sure?")&&(a=$(this).closest("form"),a.find("input[name='op']").val("update"),$.post("shop",a.serialize(),function(b){"string"==typeof b?alert(b):window.location.reload()})))});$("input.db_news_remove").click(function(){if(confirm("Are you sure?")){var a="db=news&op=remove&rowid="+$(this).closest("form").find("input[name='rowid']").val();$.post("shop",a,function(b){"string"==typeof b?alert(b):(alert("Updated"),window.location.href="?db=news")})}});$("input.db_gen_thumbnails").click(function(){if(confirm("Are you sure?")){var a=
"db=news&op=gen_thumbnails&rowid="+$(this).closest("form").find("input[name='rowid']").val();$.post("shop",a,function(b){"string"==typeof b?alert(b):alert("Updated")})}});$("input.db_news_broadcast").click(function(){if(confirm("Are you sure?")){var a="db=news&op=broadcast&rowid="+$(this).closest("form").find("input[name='rowid']").val();$.post("shop",a,function(b){"string"==typeof b?alert(b):alert("Updated")})}});$("input.db_ban_customer").click(function(){if(confirm("Are you sure?")){var a=$(this);
$.post("shop",a.closest("form").serialize()+"&"+a.attr("name")+"="+a.val(),function(b){!0===b?(alert("Changed to "+a.val()),window.location.reload(!0)):alert(b)})}});$(document).on("keydown",function(a){27===a.keyCode&&($("div#sub_op div.content").html(""),$("div#sub_op").removeClass("show"))});$("span.edit_timestamp").click(function(){$(this).parent().prev().children().removeAttr("readonly")});$("span.reset_mfcid").click(function(){$(this).parent().prev().children().val("")});$("span.select_mfcid").click(function(){var a=
$(this).parent().prev().children(),b=a.val();if(b){b=b.split("|,|");for(var c=0;c<b.length;c++)b[c]=parseInt(b[c])}else b=[];var f=a.attr("name");$.post("shop","db=item&op=get",function(e){if("string"==typeof e)alert(e);else{var d="<table class='item'><tr><th>mfcid</th></tr><tr><td><input class='filter_mfcid'></td></tr><tr><td>";console.log(e.length);for(var h=0;h<e.length;h++)d+='<div class="image'+(-1!==b.indexOf(e[h])?" selected":"")+'" data-mfcid="'+e[h]+'">',d+=e[h],d+="</div>";g(d+"</td></tr><tr><td><input class='apply_mfcid' type='button' value='Apply mfcid' /></td></tr></table>");
$("input.filter_mfcid").keyup(function(){var l=$(this).val().toString().toLowerCase();l?($("table.item div.image").hide(),$("table.item div.image").each(function(){-1!==$(this).text().toString().toLowerCase().indexOf(l)&&$(this).show()})):$("table.item div.image").show()});$("table.item div.image").click(function(){"spotlight"===f&&$("table.item div.image").removeClass("selected");$(this).toggleClass("selected")});$("table.item input.apply_mfcid").click(function(){var l=$("table.item div.image.selected").map(function(q,
p){return $(p).data("mfcid")}).get().join("|,|");a.val(l);k()})}})});$("span.edit_foreign").click(function(){"hidden"==$(this).parent().prev().children("input").attr("type")?($(this).parent().prev().children("span").hide(),$(this).parent().prev().children("input").attr("type","text")):($(this).parent().prev().children("span").show(),$(this).parent().prev().children("input").attr("type","hidden"))});$("span.reset_foreign").click(function(){$(this).parent().prev().children("span").html("");$(this).parent().prev().children("input").attr("type",
"hidden").val("")});$("span.select_foreign").click(function(){var a=$(this).parent().prev().children("input").attr("name"),b=$(this).parent().prev().children("input").val().split("|,|");$.post("shop","db=metadata&op=get&meta="+a,function(c){if("string"==typeof c)alert(c);else{var f="<table><tr><th colspan='3'>"+(a+" <input class='filter_foreign' placeholder='filter value' /></th></tr>");f+="<tr><th>key</th><th>value</th><th>apply</th></tr>";for(var e=0;e<c.length;e++)f+="<tr"+(-1!=b.indexOf(c[e].key.toString())?
" class='selected'":"")+">",f+="<td>"+c[e].key+"</td>",f+="<td>"+c[e].value+"</td>",f+="<td><span class='apply_foreign' data-value='"+c[e].value+"' data-key='"+c[e].key+"' data-meta='"+a+"'>⬛</span></td>",f+="</tr>";g(f+"</table>");$("input.filter_foreign").keyup(function(){var d=$(this).val().toLowerCase();d?($("span.apply_foreign").closest("tr").hide(),$("span.apply_foreign").each(function(){-1!=$(this).data("value").toLowerCase().indexOf(d)&&$(this).closest("tr").show()})):$("span.apply_foreign").closest("tr").show()});
$("span.apply_foreign").click(function(){if("classification"==a||"company"==a){var d=$("input[name='"+$(this).data("meta")+"']").val();d=0!==d.length?d.split("|,|"):[];var h=d.indexOf($(this).data("key").toString());-1!==h?d.splice(h,1):d.push($(this).data("key"));d=d.join("|,|");$("input[name='"+$(this).data("meta")+"']").val(d).attr("type","text").prev().hide()}else $("input[name='"+$(this).data("meta")+"']").val($(this).data("key")).prev().text($(this).data("value"));k()})}})});$("span.new_foreign").click(function(){var a=
$(this).parent().prev().children("input").attr("name");var b="<form><table><tr><th colspan='2'>"+(a+"</th></tr><tr><th>key</th><th>value</th></tr><tr>");b+="<input type='hidden' name='db' value='metadata'>";b+="<input type='hidden' name='op' value='new'>";b+="<input type='hidden' name='meta' value='"+a+"'><td><input name='key' /></td><td><input name='value' /></td>";b+="</tr>";b+="<tr><td colspan='2'><input type='button' class='db_submit' value='New foreign' /></td></tr>";b+="</table></form>";g(b)})});
